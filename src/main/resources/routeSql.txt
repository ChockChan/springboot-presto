select count(user_id) as num from cdm_event_txt where (evt = 'collect') and (dt between '2017-06-24' and '2017-11-23' )
select count(collect_product10.user_id) as num from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product10.user_id = collect_product.user_id  where collect_product.datetime > collect_product10.datetime and date_add('second', 120, collect_product10.datetime) >= collect_product.datetime
select count(collect_product10.user_id) as num from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as add_to_shopping_cart on collect_product10.user_id = add_to_shopping_cart.user_id where add_to_shopping_cart.datetime > collect_product10.datetime and date_add('second', 120, collect_product10.datetime) >= add_to_shopping_cart.datetime
select count(_collect_product10.user_id) as num from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product10.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product10.datetime and date_add('second',120,_collect_product10.datetime) >= _submit_order.datetime
select count(collect_product20.user_id) as num from (select distinct (collect_product.user_id) as user_id, collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product10.user_id = collect_product.user_id  where collect_product.datetime > collect_product10.datetime and date_add('second', 120, collect_product10.datetime) <= collect_product.datetime) as collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product20.user_id = collect_product.user_id where collect_product.datetime > collect_product20.datetime and date_add('second', -120, collect_product.datetime) >= collect_product20.datetime
select count(_collect_product20.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product20.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product20.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product20.datetime
select count(_collect_product20.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product20.user_id = _submit_order.user_id where _submit_order.datetime > _collect_product20.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product20.datetime
select count(_add_to_shopping_cart21.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime ) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _add_to_shopping_cart21.user_id = _collect_product.user_id  where _collect_product.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _collect_product.datetime) <= _add_to_shopping_cart21.datetime
select count(_add_to_shopping_cart21.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime ) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _add_to_shopping_cart21.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _add_to_shopping_cart21.datetime
select count(_add_to_shopping_cart21.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime ) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _add_to_shopping_cart21.user_id = _submit_order.user_id  where _submit_order.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _submit_order.datetime) <= _add_to_shopping_cart21.datetime
select count(_submit_order23.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product10.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product10.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product10.datetime ) as _submit_order23 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _submit_order23.user_id = _collect_product.user_id  where _collect_product.datetime > _submit_order23.datetime and date_add('second', -120, _collect_product.datetime) <= _submit_order23.datetime
select count(_submit_order23.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product10.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product10.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product10.datetime ) as _submit_order23 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _submit_order23.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _submit_order23.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _submit_order23.datetime
select count(_submit_order23.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product10.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product10.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product10.datetime ) as _submit_order23 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _submit_order23.user_id = _submit_order.user_id  where _submit_order.datetime > _submit_order23.datetime and date_add('second', -120, _submit_order.datetime) <= _submit_order23.datetime
select count(collect_product30.user_id) as num from (select distinct (collect_product.user_id) as user_id, collect_product.datetime from (select distinct (collect_product.user_id) as user_id, collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product10.user_id = collect_product.user_id  where collect_product.datetime > collect_product10.datetime and date_add('second', -120, collect_product.datetime) <= collect_product10.datetime) as collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product20.user_id = collect_product.user_id where collect_product.datetime > collect_product20.datetime and date_add('second', -120, collect_product.datetime) <= collect_product20.datetime) as collect_product30 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as collect_product on collect_product30.user_id = collect_product.user_id where collect_product.datetime > collect_product30.datetime and date_add('second', -120, collect_product.datetime) <= collect_product30.datetime
select count(_collect_product30.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime ) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product20.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product20.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product20.datetime) as _collect_product30 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product30.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product30.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product30.datetime
select count(_collect_product30.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime ) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product20.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product20.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product20.datetime) as _collect_product30 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product30.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product30.datetime and date_add('second', -120,_submit_order.datetime) <= _collect_product30.datetime
select count(_add_to_shopping_cart31.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime ) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product20.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product20.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product20.datetime ) as _add_to_shopping_cart31 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _add_to_shopping_cart31.user_id = _collect_product.user_id  where _collect_product.datetime > _add_to_shopping_cart31.datetime and date_add('second', -120,_collect_product.datetime) <= _add_to_shopping_cart31.datetime
select count(_add_to_shopping_cart31.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime ) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product20.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product20.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product20.datetime ) as _add_to_shopping_cart31 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _add_to_shopping_cart31.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _add_to_shopping_cart31.datetime and date_add('second', -120,_add_to_shopping_cart.datetime) <= _add_to_shopping_cart31.datetime
select count(_add_to_shopping_cart31.user_id) as num from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime ) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product20.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product20.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product20.datetime ) as _add_to_shopping_cart31 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _add_to_shopping_cart31.user_id = _submit_order.user_id  where _submit_order.datetime > _add_to_shopping_cart31.datetime and date_add('second', -120,_submit_order.datetime) <= _add_to_shopping_cart31.datetime
select count(_submit_order33.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product20.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product20.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product20.datetime ) as _submit_order33 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _submit_order33.user_id = _collect_product.user_id  where _collect_product.datetime > _submit_order33.datetime and date_add('second', -120,_collect_product.datetime) <= _submit_order33.datetime
select count(_submit_order33.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product20.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product20.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product20.datetime ) as _submit_order33 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _submit_order33.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _submit_order33.datetime and date_add('second', -120,_add_to_shopping_cart.datetime) <= _submit_order33.datetime
select count(_submit_order33.user_id) as num from (select distinct (_submit_order.user_id) as user_id, _submit_order.datetime from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product10.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product10.datetime and date_add('second', -120, _collect_product.datetime) <= _collect_product10.datetime) as _collect_product20 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product20.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product20.datetime and date_add('second', -120, _submit_order.datetime) <= _collect_product20.datetime ) as _submit_order33 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _submit_order33.user_id = _submit_order.user_id  where _submit_order.datetime > _submit_order33.datetime and date_add('second', -120,_submit_order.datetime) <= _submit_order33.datetime
select count(_collect_product34.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _add_to_shopping_cart21.user_id = _collect_product.user_id  where _collect_product.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _collect_product.datetime) <= _add_to_shopping_cart21.datetime ) as _collect_product34 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _collect_product34.user_id = _collect_product.user_id  where _collect_product.datetime > _collect_product34.datetime and date_add('second', -120,_collect_product.datetime) <= _collect_product34.datetime
select count(_collect_product34.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _add_to_shopping_cart21.user_id = _collect_product.user_id  where _collect_product.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _collect_product.datetime) <= _add_to_shopping_cart21.datetime ) as _collect_product34 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product34.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product34.datetime and date_add('second', -120,_add_to_shopping_cart.datetime) <= _collect_product34.datetime
select count(_collect_product34.user_id) as num from (select distinct (_collect_product.user_id) as user_id, _collect_product.datetime from (select distinct (_add_to_shopping_cart.user_id) as user_id, _add_to_shopping_cart.datetime from (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product10 join (select user_id, datetime from cdm_event_txt where evt = 'addToShoppingcart' and (dt between '2017-06-24' and '2017-11-23' )) as _add_to_shopping_cart on _collect_product10.user_id = _add_to_shopping_cart.user_id  where _add_to_shopping_cart.datetime > _collect_product10.datetime and date_add('second', -120, _add_to_shopping_cart.datetime) <= _collect_product10.datetime) as _add_to_shopping_cart21 join (select user_id, datetime from cdm_event_txt where evt = 'collect' and (dt between '2017-06-24' and '2017-11-23' )) as _collect_product on _add_to_shopping_cart21.user_id = _collect_product.user_id  where _collect_product.datetime > _add_to_shopping_cart21.datetime and date_add('second', -120, _collect_product.datetime) <= _add_to_shopping_cart21.datetime ) as _collect_product34 join (select user_id, datetime from cdm_event_txt where evt = 'submitOrder' and (dt between '2017-06-24' and '2017-11-23' )) as _submit_order on _collect_product34.user_id = _submit_order.user_id  where _submit_order.datetime > _collect_product34.datetime and date_add('second', -120,_submit_order.datetime) <= _collect_product34.datetime